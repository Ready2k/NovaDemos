<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Voice Assistant</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="app-container">
    <div class="sidebar">
      <h2>Persona Settings</h2>

      <!-- Tab Navigation -->
      <div class="tabs-nav">
        <button class="tab-btn active" data-tab="general">General</button>
        <button class="tab-btn" data-tab="prompts">Prompts</button>
        <button class="tab-btn" data-tab="system">System</button>
      </div>

      <!-- Tab Content: General -->
      <div id="tab-general" class="tab-content active">
        <div class="input-group">
          <label for="interaction-mode">Interaction Mode</label>
          <select id="interaction-mode">
            <option value="chat_voice" selected>‚ú® Chat + Voice</option>
            <option value="voice_only">üé§ Voice Only</option>
            <option value="chat_only">üí¨ Chat Only</option>
          </select>
        </div>

        <div class="input-group">
          <label for="persona-preset">Persona Preset</label>
          <select id="persona-preset">
            <option value="">Custom / Select Preset...</option>
          </select>
        </div>

        <div class="input-group">
          <label for="brain-mode">Assistant</label>
          <select id="brain-mode">
            <option value="raw_nova">‚ú® Nova Sonic (Direct)</option>
            <option value="bedrock_agent">üè¶ Banking Bot (Agent)</option>
          </select>
        </div>

        <div class="input-group">
          <label for="voice-preset">Voice</label>
          <select id="voice-preset">
            <!-- Populated by JS -->
          </select>
        </div>
      </div>

      <!-- Tab Content: Prompts -->
      <div id="tab-prompts" class="tab-content">
        <div class="input-group">
          <label for="prompt-preset">Prompt Preset</label>
          <select id="prompt-preset">
            <option value="">Custom / Select Preset...</option>
          </select>
        </div>
        <div class="input-group">
          <label for="system-prompt">System Prompt</label>
          <textarea id="systemPrompt"
            rows="10">You are a warm, professional, and helpful AI assistant. Give accurate answers that sound natural, direct, and human. Start by answering the user's question clearly in 1‚Äì2 sentences. Then, expand only enough to make the answer understandable, staying within 3‚Äì5 short sentences total. Avoid sounding like a lecture or essay.</textarea>
        </div>
        <div class="form-group">
          <label for="speechPrompt">Speech Prompt (Optional)</label>
          <textarea id="speechPrompt" rows="4"
            placeholder="e.g. If the input audio/speech contains hindi..."></textarea>
        </div>
      </div>

      <!-- Tab Content: System -->
      <div id="tab-system" class="tab-content">
        <div class="input-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
          <input type="checkbox" id="debug-mode" style="width: auto;">
          <label for="debug-mode" style="margin: 0; cursor: pointer;">Show Debug Panel</label>
        </div>

        <button id="awsConfigBtn" class="secondary-btn"
          style="width: 100%; justify-content: center; background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.4); margin-bottom: 10px;">
          üîê Configure AWS
        </button>

        <button id="agentConfigBtn" class="secondary-btn"
          style="width: 100%; justify-content: center; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.4);">
          ü§ñ Configure Agents
        </button>

        <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">

        <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #94a3b8;">Enabled Tools (Global)</h4>
        <div id="tools-list" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
          <!-- Populated by JS -->
          <div style="font-size: 0.8rem; color: #64748b; font-style: italic;">Loading tools...</div>
        </div>
      </div>

      <!-- Global Actions (Always Visible) -->
      <div class="sidebar-actions"
        style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
        <button id="saveSettingsBtn" class="secondary-btn" style="width: 100%; margin-bottom: 10px;">Save
          Settings</button>
        <button id="newSessionBtn" class="danger-btn" style="width: 100%;">New Session</button>
      </div>
    </div>

    <div class="main-content">
      <header>
        <h1>
          üéôÔ∏è Voice Assistant
          <span id="mode-indicator"
            style="font-size: 0.8rem; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 6px; vertical-align: middle; margin-left: 10px; color: #94a3b8; font-weight: normal;">Mode:
            Nova Sonic</span>
        </h1>
        <div class="header-right">
          <div id="version-info" class="version-badge">
            Loading version...
          </div>
          <div id="status" class="status-badge disconnected">
            Disconnected
          </div>
        </div>
      </header>

      <div class="visualizer">
        <div id="sessionStats" class="session-stats">
          <div class="stat-item" title="Session Duration">‚è±Ô∏è <span class="stat-label">Duration:</span> <span
              id="statDuration">00:00</span></div>
          <div class="stat-item" title="Input Tokens">üì• <span class="stat-label">Input:</span> <span
              id="statInputTokens">0</span></div>
          <div class="stat-item" title="Output Tokens">üì§ <span class="stat-label">Output:</span> <span
              id="statOutputTokens">0</span></div>
          <div class="stat-item" title="Latency">‚ö° <span class="stat-label">Latency:</span> <span
              id="statLatency">-</span></div>
        </div>
        <canvas id="visualizer"></canvas>
      </div>

      <div class="transcript-container" id="transcript">
        <div id="chat-container">
          <!-- Messages will appear here -->
        </div>
      </div>

      <div class="chat-input-container">
        <input type="text" id="textInput" placeholder="Type a message..." disabled>
        <button id="sendBtn" class="icon-btn" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
          </svg>
        </button>
      </div>

      <div class="controls">
        <button id="connectBtn" class="primary-btn">Connect</button>
        <button id="startBtn" class="primary-btn" disabled>Start Recording</button>
        <button id="stopBtn" class="danger-btn" disabled>Stop Recording</button>
        <button id="disconnectButton" class="danger-btn" disabled>Disconnect</button>
      </div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-sidebar" style="display: none;">
      <h3
        style="margin-top: 0; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 15px;">
        üõ†Ô∏è Debug Panel</h3>

      <!-- Persistent Metrics Panel (Sticky) -->
      <div id="live-metrics-panel"
        style="margin-bottom: 15px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; border: 1px solid rgba(255, 255, 255, 0.05); font-size: 0.8rem; display: none;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
          <span style="color: #94a3b8;">Latency:</span>
          <span id="debug-latency" style="color: #86efac;">--</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
          <span style="color: #94a3b8;">Tokens (Total):</span>
          <span id="debug-tokens" style="color: #cbd5e1;">0</span>
        </div>
      </div>

      <div id="debug-content">Waiting for interaction...</div>
    </div>

    <div id="toast-container"></div>
  </div>

  <script src="audio.js"></script>
  <script type="module" src="main.js"></script>

  <!-- AWS Config Modal -->
  <div id="awsModal" class="modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
    <div class="modal-content"
      style="background: #1e293b; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1);">
      <h3 style="margin-top: 0; margin-bottom: 15px;">AWS Configuration</h3>
      <p style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 20px;">Enter your AWS credentials. These are used only
        for this session and are not saved to the server.</p>

      <div class="input-group" style="margin-bottom: 15px;">
        <label for="awsAccessKey">Access Key ID</label>
        <input type="password" id="awsAccessKey" placeholder="AKIA..."
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="input-group" style="margin-bottom: 15px;">
        <label for="awsSecretKey">Secret Access Key</label>
        <input type="password" id="awsSecretKey" placeholder="wJalrX..."
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="input-group" style="margin-bottom: 15px;">
        <label for="awsRegion">Region</label>
        <input type="text" id="awsRegion" value="us-east-1" placeholder="us-east-1"
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="input-group" style="margin-bottom: 20px;">
        <label for="agentCoreRuntimeArn">Agent Core Runtime ARN (Optional)</label>
        <input type="text" id="agentCoreRuntimeArn" placeholder="arn:aws:bedrock-agentcore:..."
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="modal-actions" style="display: flex; gap: 10px; justify-content: space-between;">
        <button id="clearAwsBtn" class="danger-btn" style="font-size: 0.85rem;">Clear Stored</button>
        <div style="display: flex; gap: 10px;">
          <button id="cancelAwsBtn" class="secondary-btn">Cancel</button>
          <button id="saveAwsBtn" class="primary-btn">Update Credentials</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Agent Config Modal -->
  <div id="agentModal" class="modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
    <div class="modal-content"
      style="background: #1e293b; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; border: 1px solid rgba(255,255,255,0.1); max-height: 90vh; overflow-y: auto;">
      <h3 style="margin-top: 0; margin-bottom: 15px;">Configure Bedrock Agents</h3>
      <p style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 20px;">Add custom Bedrock Agents. These settings
        override local .env configuration.</p>

      <!-- Existing Agents List -->
      <div id="agentList" style="margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px;">
        <!-- Populated by JS -->
      </div>

      <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;">

      <h4 style="margin: 0 0 10px 0; font-size: 1rem;">Add New Agent</h4>

      <div class="input-group" style="margin-bottom: 15px;">
        <label for="newAgentName">Agent Name</label>
        <input type="text" id="newAgentName" placeholder="e.g. Travel Assistant"
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="input-group" style="margin-bottom: 15px;">
        <label for="newAgentId">Agent ID</label>
        <input type="text" id="newAgentId" placeholder="e.g. XXXXXXXXXX"
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="input-group" style="margin-bottom: 20px;">
        <label for="newAgentAliasId">Agent Alias ID</label>
        <input type="text" id="newAgentAliasId" placeholder="e.g. TSTALIASID"
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
      </div>

      <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end;">
        <button id="closeAgentBtn" class="secondary-btn">Close</button>
        <button id="addAgentBtn" class="primary-btn">Add Agent</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1100; align-items: center; justify-content: center;">
    <div class="modal-content"
      style="background: #1e293b; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1); text-align: center;">
      <h3 style="margin-top: 0; margin-bottom: 15px; color: white;">Confirm Deletion</h3>
      <p id="deleteConfirmText" style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 25px;">
        Are you sure you want to delete this agent?
      </p>
      <div class="modal-actions" style="display: flex; gap: 10px; justify-content: center;">
        <button id="cancelDeleteBtn" class="secondary-btn">Cancel</button>
        <button id="confirmDeleteBtn" class="danger-btn">Delete</button>
      </div>
    </div>
  </div>
</body>

</html>