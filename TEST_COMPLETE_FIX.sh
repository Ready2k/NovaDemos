#!/bin/bash

echo "=========================================="
echo "Testing Complete Fix - Memory + Intent + Tools"
echo "=========================================="
echo ""
echo "This test verifies:"
echo "  ✅ Verified user memory passed through handoffs"
echo "  ✅ User intent passed through handoff chain"
echo "  ✅ Banking agent uses real AgentCore tools"
echo ""
echo "Expected Journey:"
echo "  User → Triage → IDV (verify) → Banking (with name + intent) → Real Balance"
echo ""
echo "=========================================="
echo ""

# Clear old logs
echo "Clearing old logs..."
rm -f logs/*.log

# Restart services
echo "Restarting services..."
./restart-local-services.sh

echo ""
echo "=========================================="
echo "Services started. Test in frontend:"
echo ""
echo "1. Open http://localhost:3000"
echo "2. Say: 'I want to check my balance'"
echo "3. Provide: Account 12345678, Sort Code 112233"
echo ""
echo "Expected Banking Response:"
echo "  'Hello Sarah, let me fetch your balance for you...'"
echo "  [Calls agentcore_balance]"
echo "  'Your current balance is £1,234.56'"
echo ""
echo "NOT:"
echo "  'How can I help you?' ❌"
echo "  Mock data ❌"
echo ""
echo "=========================================="
echo ""
echo "Monitor logs:"
echo ""
echo "  # IDV storing verified user:"
echo "  tail -f logs/agent-idv.log | grep 'Stored verified user'"
echo ""
echo "  # IDV storing userIntent:"
echo "  tail -f logs/agent-idv.log | grep 'Stored userIntent'"
echo ""
echo "  # IDV using userIntent for handoff:"
echo "  tail -f logs/agent-idv.log | grep 'Using stored userIntent'"
echo ""
echo "  # Banking receiving context:"
echo "  tail -f logs/agent-banking.log | grep 'Injecting session context'"
echo ""
echo "  # Banking calling real tool:"
echo "  tail -f logs/agent-banking.log | grep 'agentcore_balance'"
echo ""
echo "=========================================="
